<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Execution Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        .test-container {
            margin: 20px 0;
        }
        .language-test {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .language-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pending {
            background: #3a3a3a;
            color: #cccccc;
        }
        .status.testing {
            background: #1e3a8a;
            color: #60a5fa;
        }
        .status.passed {
            background: #065f46;
            color: #34d399;
        }
        .status.failed {
            background: #7f1d1d;
            color: #f87171;
        }
        .details {
            margin-top: 10px;
            font-size: 14px;
            color: #a0a0a0;
        }
        .error {
            color: #f87171;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .summary {
            background: #252526;
            border: 2px solid #4ec9b0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: 18px;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #1177bb;
        }
        button:disabled {
            background: #3a3a3a;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üß™ Multi-Language Code Execution Test</h1>
    <p>Testing the Two Sum problem across all supported languages</p>
    
    <button id="runTests" onclick="runAllTests()">Run All Tests</button>
    
    <div id="testContainer" class="test-container"></div>
    
    <div id="summary" class="summary" style="display: none;"></div>

    <script>
        const testCases = [
            {
                id: 'test1',
                type: 'sample',
                input: { nums: [2, 7, 11, 15], target: 9 },
                output: [0, 1]
            },
            {
                id: 'test2',
                type: 'sample',
                input: { nums: [3, 2, 4], target: 6 },
                output: [1, 2]
            }
        ];

        const solutions = {
            javascript: {
                code: `function twoSum(nums, target) {
    const map = new Map();
    for (let i = 0; i < nums.length; i++) {
        const complement = target - nums[i];
        if (map.has(complement)) {
            return [map.get(complement), i];
        }
        map.set(nums[i], i);
    }
    return [];
}
module.exports = twoSum;`,
                functionName: 'twoSum'
            },
            typescript: {
                code: `function twoSum(nums: number[], target: number): number[] {
    const map = new Map<number, number>();
    for (let i = 0; i < nums.length; i++) {
        const complement = target - nums[i];
        if (map.has(complement)) {
            return [map.get(complement)!, i];
        }
        map.set(nums[i], i);
    }
    return [];
}
module.exports = twoSum;`,
                functionName: 'twoSum'
            },
            python: {
                code: `def twoSum(nums, target):
    num_map = {}
    for i, num in enumerate(nums):
        complement = target - num
        if complement in num_map:
            return [num_map[complement], i]
        num_map[num] = i
    return []`,
                functionName: 'twoSum'
            },
            java: {
                code: `import java.util.*;

class Solution {
    public int[] twoSum(int[] nums, int target) {
        Map<Integer, Integer> map = new HashMap<>();
        for (int i = 0; i < nums.length; i++) {
            int complement = target - nums[i];
            if (map.containsKey(complement)) {
                return new int[]{map.get(complement), i};
            }
            map.put(nums[i], i);
        }
        return new int[]{};
    }
}`,
                functionName: 'twoSum'
            },
            cpp: {
                code: `#include <vector>
#include <unordered_map>
using namespace std;

class Solution {
public:
    vector<int> twoSum(vector<int>& nums, int target) {
        unordered_map<int, int> map;
        for (int i = 0; i < nums.size(); i++) {
            int complement = target - nums[i];
            if (map.find(complement) != map.end()) {
                return {map[complement], i};
            }
            map[nums[i]] = i;
        }
        return {};
    }
};`,
                functionName: 'twoSum'
            },
            go: {
                code: `func twoSum(nums []int, target int) []int {
    numMap := make(map[int]int)
    for i, num := range nums {
        complement := target - num
        if j, found := numMap[complement]; found {
            return []int{j, i}
        }
        numMap[num] = i
    }
    return []int{}
}`,
                functionName: 'twoSum'
            },
            rust: {
                code: `use std::collections::HashMap;

pub fn twoSum(nums: Vec<i32>, target: i32) -> Vec<i32> {
    let mut map = HashMap::new();
    for (i, &num) in nums.iter().enumerate() {
        let complement = target - num;
        if let Some(&j) = map.get(&complement) {
            return vec![j as i32, i as i32];
        }
        map.insert(num, i);
    }
    vec![]
}`,
                functionName: 'twoSum'
            },
            csharp: {
                code: `using System;
using System.Collections.Generic;

public class Solution {
    public int[] TwoSum(int[] nums, int target) {
        Dictionary<int, int> map = new Dictionary<int, int>();
        for (int i = 0; i < nums.Length; i++) {
            int complement = target - nums[i];
            if (map.ContainsKey(complement)) {
                return new int[] { map[complement], i };
            }
            map[nums[i]] = i;
        }
        return new int[] { };
    }
}`,
                functionName: 'TwoSum'
            }
        };

        function createLanguageTestElement(language) {
            const div = document.createElement('div');
            div.className = 'language-test';
            div.id = `test-${language}`;
            div.innerHTML = `
                <div class="language-name">
                    ${language.toUpperCase()}
                    <span class="status pending" id="status-${language}">Pending</span>
                </div>
                <div class="details" id="details-${language}"></div>
            `;
            return div;
        }

        async function testLanguage(language) {
            const statusEl = document.getElementById(`status-${language}`);
            const detailsEl = document.getElementById(`details-${language}`);
            
            statusEl.className = 'status testing';
            statusEl.textContent = 'Testing...';
            
            try {
                const solution = solutions[language];
                const response = await fetch('/api/practice/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        language,
                        code: solution.code,
                        functionName: solution.functionName,
                        tests: testCases
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    statusEl.className = 'status failed';
                    statusEl.textContent = 'Failed';
                    detailsEl.innerHTML = `<div class="error">Error: ${data.error}</div>`;
                    return false;
                }

                const allPassed = data.results.every(r => r.pass);
                if (allPassed) {
                    statusEl.className = 'status passed';
                    statusEl.textContent = 'Passed ‚úì';
                    detailsEl.textContent = `All ${data.results.length} test cases passed`;
                    return true;
                } else {
                    statusEl.className = 'status failed';
                    statusEl.textContent = 'Failed';
                    const failures = data.results.filter(r => !r.pass);
                    detailsEl.innerHTML = failures.map(r => 
                        `<div class="error">Test ${r.id}: Expected ${JSON.stringify(r.expected)}, Got ${JSON.stringify(r.actual)}${r.error ? `\nError: ${r.error}` : ''}</div>`
                    ).join('');
                    return false;
                }
            } catch (error) {
                statusEl.className = 'status failed';
                statusEl.textContent = 'Error';
                detailsEl.innerHTML = `<div class="error">${error.message}</div>`;
                return false;
            }
        }

        async function runAllTests() {
            const button = document.getElementById('runTests');
            button.disabled = true;
            button.textContent = 'Testing...';
            
            const container = document.getElementById('testContainer');
            container.innerHTML = '';
            
            const summaryEl = document.getElementById('summary');
            summaryEl.style.display = 'none';
            
            // Create test elements
            for (const language of Object.keys(solutions)) {
                container.appendChild(createLanguageTestElement(language));
            }
            
            // Run tests sequentially
            const results = {};
            for (const language of Object.keys(solutions)) {
                results[language] = await testLanguage(language);
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // Show summary
            const passed = Object.values(results).filter(r => r).length;
            const total = Object.keys(results).length;
            
            summaryEl.style.display = 'block';
            summaryEl.innerHTML = `
                <strong>Test Summary:</strong><br>
                ${passed}/${total} languages working correctly<br><br>
                ${passed === total ? 
                    'üéâ All languages are working perfectly!' : 
                    `‚ö†Ô∏è ${total - passed} language(s) need attention`
                }
            `;
            
            button.disabled = false;
            button.textContent = 'Run All Tests Again';
        }
    </script>
</body>
</html>
